---
title: "Stats506_PS3"
format:
  html:
    embed-resources: true
editor: visual
---

# Problem 1 - Vision

### Part A:

I will download the VIX_D file and DEMO_D file. I will merge the two files to create a single Stata dataset, using the SEQN variable for merging. I will keep only records which match. Below I will print my total size, showing that it is now 6,980.

### Part B:

Without fitting any models, I will estimate the proportion of respondents within each 10-year age bracket (eg. 0-9, 10-19, 20-29, etc) who wear glasses/contact lenses for distance vision. I will produce a nice table with the results below. (There was hint)

### Part C:

Fit three logistic regression models predicting whether a respondent wears glasses/contact lenses for distance vision. Predictors:

1.  age
2.  age, race, gender
3.  age, race, gender, poverty income ratio

Next, I will produce a table presenting the estimated odds ratios for the coefficients in each model along with the sample size for the model, the pseud-R\^2, and AIC values.

### Part D:

From the third model from the previous part, I will discuss whether the *odds* of men and women being wears of glasses/contact lenses for distance vision differ. I will test whether the *proportion* of wearers of glasses/contact lenses for distance vision differs between men and women. I will include the results of the test and its interpretation.

# Problem 2 - Sakila

Load the "sakila" database discussed in class into SQLite. It can be downloaded from the link provided.

```{r}
library(DBI)
library(RSQLite)
```

```{r}
#Load the "sakila" database into SQLite
sakila <- dbConnect(RSQLite::SQLite(), "/Users/19892/OneDrive/Documents/STATS506/ProblemSets/Stats506_PS3/sakila_master.db")
```

### Part A:

Aside from English, what language is most common for films? Answer this with a a single SQL query.

To get a feel for the data base, here are the table names

```{r}
dbListTables(sakila)
```

Below are the languages:

```{r}
dbListFields(sakila, "language")
dbGetQuery(sakila, "SELECT name FROM language")
dbGetQuery(sakila, "SELECT language_id from language")
```

```{r}
dbGetQuery(sakila,"
SELECT language.name AS most_common_language, COUNT(*) AS film_count
FROM film
INNER JOIN language ON film.language_id = language.language_id
WHERE language.name != 'English'
GROUP BY language.name
ORDER BY film_count DESC
LIMIT 1
           "
           )
```

Above we get that there are no films with the language being something other than English. Therefore, English is the only language being used in this database and therefore is the most popular

*For each of the following questions, solve them in two ways: First, use SQL query or queries to extract the appropriate table(s), then use regular R to answer the question. Second, use a single SQL query to answer the question.*

### Part B: What genre of movie is the most common in the data, and how many movies are of this genre?

SQL:

Multiple Queries: First I will print out all the genres to get a feel with what options we have below:

```{r}
dbListFields(sakila, "film_category")
dbGetQuery(sakila, "SELECT name FROM category")
```

Below, COUNT and GROUP BY/ORDER BY prints me out a table that gives each category_id (like the genre id) and the count of each, ORDER BY puts the counts in order, wit the category_id of 15 being at the top of the count.

```{r}
dbGetQuery(sakila,"
  SELECT category_id, COUNT(*) AS genre_count
    FROM film_category
    GROUP BY category_id
    ORDER BY genre_count DESC
           "
           )
```

Below I will find which genre has the category_id of 15:

```{r}
dbGetQuery(sakila,"
  SELECT category.name AS genre_count
      FROM category
      WHERE category.category_id = 15
           "
           )
```

Above, we can see that the category_id of the most popular genre of the films in this database is sports.

Below, I will answer the same question with a single query:

```{r}
dbGetQuery(sakila, "
SELECT category.name AS most_common_genre, COUNT(*) AS movie_count
FROM film
INNER JOIN film_category ON film.film_id = film_category.film_id
INNER JOIN category ON film_category.category_id = category.category_id
GROUP BY category.name
ORDER BY movie_count DESC
LIMIT 1
")
```

Above, in a single SQL query, I have also found that the most popular genre of film is sports.

### Part C: Identify which country or countries have exactly 9 customers. Answer this with a single SQL query. 

```{r}

```
